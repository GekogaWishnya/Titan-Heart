[gd_scene load_steps=22 format=3 uid="uid://cf4vrs85k730j"]

[ext_resource type="Texture2D" uid="uid://36qdlakvg0u" path="res://Skyboxes/day_halfed.png" id="1_jjvhh"]
[ext_resource type="Material" uid="uid://cwr7da5v1w1i6" path="res://Shaders/Water/day_water.tres" id="2_jjvhh"]
[ext_resource type="Script" uid="uid://4rhcdcposffy" path="res://Scripts/Player/player_controller.gd" id="3_8gbba"]
[ext_resource type="Shader" uid="uid://bw0p0fbtu1u6j" path="res://Shaders/Ripple/ripple.gdshader" id="3_21xkr"]
[ext_resource type="ArrayMesh" uid="uid://q5t07kgd0fxg" path="res://Meshes/Ripple/ripple.obj" id="3_kry3j"]
[ext_resource type="Script" uid="uid://biwmtkvwnm1v6" path="res://Scripts/Environment/Encased Area/encased_area.gd" id="5_344ge"]
[ext_resource type="Script" uid="uid://dser4q81gmdgh" path="res://Scripts/Camera/camera_rotation.gd" id="5_kry3j"]
[ext_resource type="Script" uid="uid://ca5pj71tqa63w" path="res://Scripts/Camera/camera_anchor.gd" id="6_6bp64"]

[sub_resource type="Shader" id="Shader_kry3j"]
code = "shader_type sky;

uniform sampler2D source_panorama : filter_linear, source_color, hint_default_black;
uniform float exposure : hint_range(0, 128) = 1.0;

uniform vec4 water_color : source_color = vec4(0.467, 0.812, 0.949, 1.0);
uniform float tone_factor : hint_range(0.0, 10.0, 0.01) = 1.0;

float expStep(float x, float n)
{
    return exp2(-exp2(n)*pow(x,n));
}

void sky() {
	vec2 uv = SKY_COORDS;
	uv.y = uv.y * 2.0;
	
	COLOR = texture(source_panorama, uv).rgb * exposure;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_21xkr"]
shader = SubResource("Shader_kry3j")
shader_parameter/source_panorama = ExtResource("1_jjvhh")
shader_parameter/exposure = 2.0
shader_parameter/water_color = Color(0.467, 0.812, 0.949, 1)
shader_parameter/tone_factor = 1.0

[sub_resource type="Sky" id="Sky_kry3j"]
sky_material = SubResource("ShaderMaterial_21xkr")

[sub_resource type="Environment" id="Environment_21xkr"]
background_mode = 2
sky = SubResource("Sky_kry3j")
tonemap_white = 0.66
glow_enabled = true
glow_levels/1 = 0.1
glow_levels/2 = 0.1
glow_levels/3 = 0.0
glow_levels/5 = 0.0
glow_normalized = true
glow_intensity = 0.5
glow_strength = 0.8
glow_hdr_threshold = 1.45
glow_hdr_luminance_cap = 40.0
fog_depth_curve = 413.104
fog_depth_begin = 3420.5
fog_depth_end = 4000.0

[sub_resource type="SphereShape3D" id="SphereShape3D_21xkr"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_jjvhh"]
diffuse_mode = 3
specular_mode = 1
albedo_color = Color(0.321808, 0.73, 0.2847, 1)
metallic_specular = 0.0
distance_fade_mode = 2
distance_fade_min_distance = 450.0
distance_fade_max_distance = 400.0

[sub_resource type="SphereMesh" id="SphereMesh_jjvhh"]

[sub_resource type="WorldBoundaryShape3D" id="WorldBoundaryShape3D_21xkr"]

[sub_resource type="PlaneMesh" id="PlaneMesh_7u77a"]

[sub_resource type="BoxShape3D" id="BoxShape3D_ynf5e"]
size = Vector3(1000, 100, 1000)

[sub_resource type="CapsuleMesh" id="CapsuleMesh_bo1nx"]

[sub_resource type="BoxShape3D" id="BoxShape3D_8gbba"]
size = Vector3(1, 2, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_6bp64"]
render_priority = 0
shader = ExtResource("3_21xkr")
shader_parameter/albedo = Color(2, 2, 2, 1)

[node name="Main" type="Node3D"]

[node name="World Environment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_21xkr")

[node name="Directional Light" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 500, 0)

[node name="Camera Anchor" type="Node3D" parent="." node_paths=PackedStringArray("follow")]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 5, 70)
script = ExtResource("6_6bp64")
follow = NodePath("../Player")

[node name="Camera" type="Camera3D" parent="Camera Anchor" node_paths=PackedStringArray("anchor")]
transform = Transform3D(-4.37114e-08, -0.714473, 0.699663, 0, 0.699663, 0.714473, -1, 3.12306e-08, -3.05833e-08, 24.5, 25, 0)
fov = 90.0
script = ExtResource("5_kry3j")
anchor = NodePath("..")
rotation_duration = 0.45

[node name="Environment" type="Node3D" parent="."]

[node name="Island SB" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1000, 0, 0, 0, 1000, 0, 0, 0, 1000, 0, -496, 0)
collision_layer = 2

[node name="Collision Shape" type="CollisionShape3D" parent="Environment/Island SB"]
shape = SubResource("SphereShape3D_21xkr")

[node name="Island" type="MeshInstance3D" parent="Environment/Island SB"]
material_override = SubResource("StandardMaterial3D_jjvhh")
cast_shadow = 0
mesh = SubResource("SphereMesh_jjvhh")
skeleton = NodePath("../..")

[node name="Water SB" type="StaticBody3D" parent="Environment"]
collision_layer = 2

[node name="Collision Shape" type="CollisionShape3D" parent="Environment/Water SB"]
transform = Transform3D(1, -0.000518215, -7.46396e-05, 0.000518216, 1, 6.0993e-06, 7.46364e-05, -6.13798e-06, 1, 0, 0, 0)
shape = SubResource("WorldBoundaryShape3D_21xkr")

[node name="Water" type="MeshInstance3D" parent="Environment/Water SB"]
transform = Transform3D(5000, -2.59108, -0.373198, 2.59108, 5000, 0.0304965, 0.373182, -0.0306899, 5000, 0, 0, 0)
material_override = ExtResource("2_jjvhh")
cast_shadow = 0
mesh = SubResource("PlaneMesh_7u77a")
skeleton = NodePath("../../..")

[node name="Encased Area" type="Area3D" parent="Environment" node_paths=PackedStringArray("collision")]
collision_layer = 2
script = ExtResource("5_344ge")
collision = NodePath("Collision Shape")

[node name="Collision Shape" type="CollisionShape3D" parent="Environment/Encased Area"]
shape = SubResource("BoxShape3D_ynf5e")

[node name="Player" type="CharacterBody3D" parent="." node_paths=PackedStringArray("camera_anchor")]
transform = Transform3D(5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 5, 70)
collision_mask = 2
script = ExtResource("3_8gbba")
speed = 35.0
camera_anchor = NodePath("../Camera Anchor")

[node name="Player Body" type="MeshInstance3D" parent="Player"]
mesh = SubResource("CapsuleMesh_bo1nx")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Player"]
shape = SubResource("BoxShape3D_8gbba")

[node name="Ripple" type="MeshInstance3D" parent="Player"]
transform = Transform3D(0.6, 0, 0, 0, 0.6, 0, 0, 0, 0.6, 0, -0.99, 0)
material_override = SubResource("ShaderMaterial_6bp64")
cast_shadow = 0
ignore_occlusion_culling = true
mesh = ExtResource("3_kry3j")
skeleton = NodePath("../../Environment")

[connection signal="body_exited" from="Environment/Encased Area" to="Environment/Encased Area" method="_on_body_exited"]
